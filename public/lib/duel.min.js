/*!
 * DuelJS JavaScript Library v1.2.0
 * https://github.com/studentIvan/dueljs
 * http://dueljs.readthedocs.org/en/latest/
 *
 * Copyright 2014 Maslov Ivan
 * Released under the MIT license
 * https://raw.githubusercontent.com/studentIvan/dueljs/master/LICENSE
 */

duel={};duel.useStorageEvent=!/trident|MSIE/i.test(navigator.userAgent);duel.isLocalStorageAvailable=function(){try{return"localStorage"in window&&window["localStorage"]!==null&&window["localStorage"]!==undefined}catch(e){return false}};duel.clone=function(e){var t;if(null==e||"object"!=typeof e)return e;if(e instanceof Object){t={};for(var n in e){if(e.hasOwnProperty(n))t[n]=duel.clone(e[n])}return t}throw new Error("Unable to copy obj! Its type isn't supported.")};duel.DuelAbstractChannel=function(){var e=function(){};e.prototype.getName=function(){return this._name};e.prototype.setCurrentWindowAsMaster=function(){return true};e.prototype.currentWindowIsMaster=function(){return true};e.prototype.broadcast=function(e){if(this.currentWindowIsMaster()){this.executeTrigger({name:e,args:Array.prototype.slice.call(arguments,1)})}};e.prototype.emit=function(e){this.broadcast(e)};e.prototype.executeTrigger=function(e,t){t=t||false;if(!(e instanceof Object)){throw"triggerDetails should be an Object"}if(!this.currentWindowIsMaster()||t){try{if(this._triggers[e.name]instanceof Array){this._triggers[e.name][0].apply(this,e.args);delete this._triggers[e.name]}else{this._triggers[e.name].apply(this,e.args)}}catch(n){}}};e.prototype.on=function(e,t){if(!this._triggers){this._triggers={}}this._triggers[e]=t};e.prototype.once=function(e,t){this.on(e,[t])};e.prototype.off=function(e){try{delete this._triggers[e]}catch(t){}};return e}();duel._generateWindowID=function(){this._windowID=+Math.random().toString().split(".")[1];return this._windowID};duel.getWindowID=function(){return this._windowID?this._windowID:this._generateWindowID()};duel.DuelLocalStorageChannel=function(e){this._name=e;this.setCurrentWindowAsMaster()};duel.DuelLocalStorageChannel.prototype=duel.clone(duel.DuelAbstractChannel.prototype);duel.DuelLocalStorageChannel.prototype.setCurrentWindowAsMaster=function(){var e,t,n,r,i=duel.getWindowID(),s="dueljs_channel_"+this.getName();if(n=localStorage.getItem(s)){for(n=JSON.parse(n),r=-1,e=0,t=n.length;e<t;e++){n[e].master=false;if(n[e].id===i){r=e}}if(r===-1){n.push({id:i,master:true})}else{n[r].master=true}localStorage.setItem(s,JSON.stringify(n))}else{localStorage.setItem(s,JSON.stringify([{id:i,master:true}]))}return true};duel.DuelLocalStorageChannel.prototype.currentWindowIsMaster=function(){var e,t,n,r,i=duel.getWindowID(),s="dueljs_channel_"+this.getName();if(n=localStorage.getItem(s)){for(n=JSON.parse(n),r=-1,e=0,t=n.length;e<t;e++){if(n[e].id===i){r=e;break}}return r===-1?false:n[r].master}else{return false}};duel.DuelLocalStorageChannel.prototype.broadcast=function(e){if(this.currentWindowIsMaster()){localStorage.setItem("dueljs_trigger",JSON.stringify({channelName:this.getName(),triggerDetails:{name:e,args:Array.prototype.slice.call(arguments,1)}}));localStorage.setItem("dueljs_trigger_event_key",+Math.random().toString().split(".")[1])}};duel.DuelFakeChannel=function(e){this._name=e;console.error("DuelJS warning: instanceof DuelFakeChannel was created, "+"check the localStorage support in your browser")};duel.DuelFakeChannel.prototype=duel.clone(duel.DuelAbstractChannel.prototype);duel.activeChannels=[];duel.channel=function(e){for(var t in duel.activeChannels){if(duel.activeChannels.hasOwnProperty(t)&&duel.activeChannels[t].getName()==e){return duel.activeChannels[t]}}var n=this.isLocalStorageAvailable()?new this.DuelLocalStorageChannel(e):new this.DuelFakeChannel(e);duel.activeChannels.push(n);return n};duel.makeCurrentWindowMaster=function(){for(var e=duel.activeChannels.length-1;e>=0;e--){try{duel.activeChannels[e].setCurrentWindowAsMaster()}catch(t){}}};window.onfocus=function(){duel.makeCurrentWindowMaster()};window.isMaster=function(){return duel.activeChannels.length?duel.activeChannels[0].currentWindowIsMaster():false};duel.addEvent=function(){if(document.addEventListener){return function(e,t,n){if(e&&e.nodeName||e===window){e.addEventListener(t,n,false)}else if(e&&e.length){for(var r=0;r<e.length;r++){addEvent(e[r],t,n)}}}}else{return function(e,t,n){if(e&&e.nodeName||e===window){e.attachEvent("on"+t,function(){return n.call(e,window.event)})}else if(e&&e.length){for(var r=0;r<e.length;r++){addEvent(e[r],t,n)}}}}}();duel.addEvent(window,"visibilitychange",function(){if(!document.hidden){duel.makeCurrentWindowMaster()}});duel.storageEvent=function(e){if(e.key=="dueljs_trigger"){var t=JSON.parse(e.newValue);for(var n=duel.activeChannels.length-1;n>=0;n--){try{if(duel.activeChannels[n].getName()==t.channelName){duel.activeChannels[n].executeTrigger(t.triggerDetails)}}catch(r){}}}};if(duel.isLocalStorageAvailable()){duel.storageOldTriggerValue=localStorage.getItem("dueljs_trigger_event_key");if(duel.useStorageEvent){duel.addEvent(window,"storage",function(e){var t=e||t||window.event;if(t.key=="dueljs_trigger_event_key"&&t.newValue!=duel.storageOldTriggerValue){duel.storageOldTriggerValue=localStorage.getItem("dueljs_trigger_event_key");duel.storageEvent({key:"dueljs_trigger",newValue:localStorage.getItem("dueljs_trigger")})}})}else{setInterval(function(){if(localStorage.getItem("dueljs_trigger_event_key")!=duel.storageOldTriggerValue){duel.storageOldTriggerValue=localStorage.getItem("dueljs_trigger_event_key");duel.storageEvent({key:"dueljs_trigger",newValue:localStorage.getItem("dueljs_trigger")})}},100)}}